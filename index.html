<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <title>Fiore Di Ale | Florer√≠a y Regalos en Lima</title>
    <meta name="description" content="Arreglos florales, tulipanes, peluches y boxes personalizados en Lima Norte.">
    
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400..900;1,400..900&family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <style>
        /* --- PALETA DE COLORES --- */
        :root {
            --fiore-bg-light: #F0EDEB;
            --fiore-beige: #D9D0CE;
            --fiore-pink: #EFA2A5;
            --fiore-burgundy: #6B2E3E;
            --text-dark: var(--fiore-burgundy);
            --gold: #D4AF37;
        }

        html { scroll-behavior: smooth; }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Poppins', sans-serif; }
        
        /* Tipograf√≠a del T√≠tulo */
        .serif-font { font-family: 'Playfair Display', serif; }

        body { background-color: var(--fiore-bg-light); display: flex; justify-content: center; min-height: 100vh; }

        .app-container {
            width: 100%; background-color: white;
            min-height: 100vh; position: relative; padding-bottom: 160px;
            box-shadow: 0 0 30px rgba(107, 46, 62, 0.05);
        }
        @media (min-width: 768px) {
            .app-container { max-width: 1200px; margin: 30px; border-radius: 30px; padding-bottom: 140px; overflow: hidden; }
        }

        /* --- HEADER --- */
        header {
            background-color: white; position: sticky; top: 0; z-index: 50;
            border-bottom: 1px solid var(--fiore-beige); padding: 15px 0;
            display: flex; flex-direction: column; align-items: center;
        }
        
        .nav-top { 
            width: 100%; display: flex; justify-content: center; align-items: center; 
            padding: 0 25px; position: relative;
        }
        
        .header-title { 
            font-weight: 700; font-size: 38px; line-height: 1; 
            color: var(--fiore-burgundy); text-align: center;
        }
        .header-subtitle { font-size: 11px; color: #999; letter-spacing: 2px; text-transform: uppercase; margin-top: 5px; }

        .menu-toggle { font-size: 24px; color: var(--fiore-burgundy); cursor: pointer; position: absolute; right: 25px; top: 50%; transform: translateY(-50%); }
        
        /* Men√∫ */
        .nav-menu {
            display: none; width: 100%; flex-direction: column; gap: 20px; text-align: center;
            padding: 20px 0; border-top: 1px solid #eee; margin-top: 15px; background: white;
        }
        .nav-menu.active { display: flex; }
        .nav-link { text-decoration: none; color: #555; font-weight: 500; font-size: 14px; text-transform: uppercase; transition: 0.3s; }
        .nav-link:hover { color: var(--fiore-burgundy); font-weight: 700; }

        @media (min-width: 768px) {
            .menu-toggle { display: none; }
            header { padding-top: 30px; }
            .header-title { font-size: 52px; }
            .nav-menu { 
                display: flex; flex-direction: row; justify-content: center; 
                border: none; margin-top: 25px; gap: 40px; 
            }
        }

        /* --- NOVEDADES --- */
        .featured-section { padding: 40px 20px; background: white; text-align: center; border-bottom: 10px solid var(--fiore-bg-light); }
        .section-title { font-size: 28px; color: var(--fiore-burgundy); text-align: center; margin-bottom: 30px; }
        
        .featured-grid { 
            display: flex; gap: 20px; overflow-x: auto; padding-bottom: 10px; 
            scrollbar-width: none; scroll-snap-type: x mandatory;
        }
        .featured-grid::-webkit-scrollbar { display: none; }
        
        .featured-card { 
            min-width: 220px; background: white; border-radius: 15px; overflow: hidden; 
            position: relative; border: 1px solid var(--fiore-pink); scroll-snap-align: center;
        }
        .featured-badge { position: absolute; top: 10px; left: 10px; background: var(--fiore-burgundy); color: white; padding: 4px 10px; font-size: 10px; border-radius: 10px; z-index: 2; font-weight: 700; }
        .featured-img { width: 100%; height: 220px; object-fit: cover; }
        
        @media (min-width: 768px) { .featured-grid { justify-content: center; } }

        /* --- CAT√ÅLOGO --- */
        .controls-container { display: flex; gap: 10px; justify-content: center; flex-wrap: wrap; margin-bottom: 20px; padding: 0 20px; }
        .search-box { flex-grow: 1; display: flex; align-items: center; background: white; border: 1px solid var(--fiore-beige); border-radius: 20px; padding: 10px 20px; max-width: 400px; }
        .search-box input { border: none; outline: none; width: 100%; margin-left: 10px; color: var(--text-dark); }
        .sort-select { padding: 10px 15px; border-radius: 20px; border: 1px solid var(--fiore-beige); background: white; color: var(--text-dark); outline: none; cursor: pointer; }

        .filter-wrapper { padding: 0 20px; margin-bottom: 30px; display: flex; justify-content: center; }
        .filters { display: flex; gap: 10px; overflow-x: auto; padding: 5px; scrollbar-width: none; }
        .filter-btn { padding: 8px 20px; border-radius: 30px; border: 1px solid var(--fiore-beige); background: white; color: var(--text-dark); cursor: pointer; white-space: nowrap; transition: 0.3s; }
        .filter-btn.active { background-color: var(--fiore-burgundy); color: white; border-color: var(--fiore-burgundy); }
        @media (min-width: 768px) { .filters { flex-wrap: wrap; justify-content: center; } }

        .product-grid { display: grid; gap: 15px; padding: 0 20px; grid-template-columns: repeat(2, 1fr); margin-bottom: 40px; }
        @media (min-width: 768px) { .product-grid { grid-template-columns: repeat(3, 1fr); gap: 30px; padding: 0 50px; } }
        
        .card { background: white; border-radius: 20px; overflow: hidden; border: 1px solid var(--fiore-beige); display: flex; flex-direction: column; transition: 0.3s; }
        .card.selected { border: 2px solid var(--fiore-burgundy); background-color: #fff5f8; }
        
        /* Fotos Verticales */
        .card-image-container { 
            height: 250px; position: relative; overflow: hidden; background: var(--fiore-bg-light); 
        }
        @media (min-width: 768px) { .card-image-container { height: 320px; } }
        
        .card-img { width: 100%; height: 100%; object-fit: cover; transition: 0.5s; }
        .badge-offer { position: absolute; top: 10px; right: 10px; background: var(--fiore-pink); color: var(--fiore-burgundy); padding: 4px 10px; border-radius: 10px; font-size: 10px; font-weight: 700; z-index: 2; }
        
        .card-content { padding: 15px; display: flex; flex-direction: column; justify-content: space-between; flex-grow: 1; }
        .card-title { font-size: 14px; font-weight: 600; color: var(--text-dark); margin-bottom: 5px; line-height: 1.2; }
        .price { color: var(--fiore-burgundy); font-weight: 700; font-size: 16px; margin-bottom: 10px; }
        .btn-select { width: 100%; padding: 8px; border: 1px solid var(--fiore-burgundy); background: transparent; color: var(--fiore-burgundy); border-radius: 12px; cursor: pointer; font-weight: 600; }
        .btn-select.active { background: var(--fiore-burgundy); color: white; }

        /* --- TESTIMONIOS (CARRUSEL M√ìVIL) --- */
        .testi-section { background: white; padding: 20px 0; }
        
        /* Contenedor principal de testimonios */
        .testimonials-wrapper {
            position: relative;
            width: 100%;
            max-width: 1000px;
            margin: 0 auto;
            min-height: 350px; /* Altura fija para que no salte */
            padding: 0 20px;
        }

        /* Estilo base de la tarjeta */
        .testi-card { 
            background: white; border-radius: 15px; border: 1px solid #eee; overflow: hidden; 
            text-align: center; padding-bottom: 15px; 
            transition: opacity 1s ease-in-out; /* Transici√≥n suave de 1 seg */
        }
        .testi-img { width: 100%; height: 200px; object-fit: cover; }
        .testi-text { padding: 15px; font-style: italic; font-size: 13px; color: #666; }
        .testi-author { font-weight: 700; color: var(--fiore-burgundy); text-transform: uppercase; font-size: 12px; }

        /* M√ìVIL: Efecto Superpuesto (Fade) */
        @media (max-width: 767px) {
            .testi-card {
                position: absolute;
                top: 0; left: 20px; right: 20px; /* Ajustar m√°rgenes laterales */
                opacity: 0; /* Oculto por defecto */
                pointer-events: none;
            }
            .testi-card.active {
                opacity: 1; /* Visible */
                pointer-events: all;
                z-index: 2;
            }
        }

        /* PC: Grilla Normal */
        @media (min-width: 768px) {
            .testimonials-wrapper {
                display: grid;
                grid-template-columns: repeat(3, 1fr);
                gap: 30px;
                min-height: auto;
            }
            .testi-card {
                position: relative; /* Reset posicionamiento */
                opacity: 1; /* Siempre visibles */
                left: auto; right: auto; top: auto;
            }
        }

        /* --- SOBRE NOSOTROS (50/50) --- */
        .about-section { background: white; padding: 50px 20px; border-top: 1px solid #eee; }
        .about-container { display: flex; flex-direction: column; gap: 30px; align-items: center; }
        .about-img { width: 100%; border-radius: 20px; height: 300px; object-fit: cover; }
        .about-txt { text-align: center; line-height: 1.8; color: #555; }
        
        @media (min-width: 768px) {
            .about-container { flex-direction: row; gap: 50px; max-width: 1000px; margin: 0 auto; }
            .about-img { width: 50%; height: 400px; } 
            .about-txt { width: 50%; padding: 0 20px; text-align: center; font-size: 16px; } 
        }

        /* --- FOOTER --- */
        .footer-contact { text-align: center; padding: 50px 20px; background: white; border-top: 1px solid var(--fiore-beige); margin-top: 40px; }
        .social-icons { display: flex; justify-content: center; gap: 30px; margin-top: 20px; }
        .social-link { 
            text-decoration: none !important; 
            font-size: 32px; color: var(--fiore-burgundy); transition: 0.3s;
            display: flex; align-items: center; justify-content: center; width: 60px; height: 60px;
            background: #fdfdfd; border-radius: 50%; box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }
        .social-link:hover { transform: translateY(-5px); color: var(--fiore-pink); }

        /* --- FLOTANTES --- */
        .whatsapp-float { position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%); width: 90%; max-width: 350px; background: #25D366; color: white; padding: 15px 25px; border-radius: 50px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 10px 30px rgba(37,211,102,0.3); z-index: 90; font-weight: 600; opacity: 0; pointer-events: none; transition: 0.3s; }
        .whatsapp-float.visible { opacity: 1; pointer-events: all; bottom: 40px; }

        .discount-container { position: fixed; bottom: 100px; left: 50%; transform: translateX(-50%); width: 90%; max-width: 380px; background: white; padding: 15px; border-radius: 20px; box-shadow: 0 5px 25px rgba(0,0,0,0.1); z-index: 89; opacity: 0; pointer-events: none; border: 1px solid var(--fiore-pink); transition: 0.3s; }
        .discount-container.visible { opacity: 1; pointer-events: all; }
        .progress-track { width: 100%; height: 6px; background: #eee; border-radius: 10px; overflow: hidden; margin: 8px 0; }
        .progress-fill { height: 100%; background: linear-gradient(90deg, var(--fiore-pink), var(--fiore-burgundy)); width: 0%; transition: width 0.5s; }

        /* --- MODALES --- */
        .modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(107,46,62,0.6); z-index: 1000; justify-content: center; align-items: center; backdrop-filter: blur(4px); }
        .modal-box { background: white; width: 90%; max-width: 400px; border-radius: 25px; overflow: hidden; position: relative; animation: popUp 0.4s ease; }
        @keyframes popUp { from { transform: scale(0.8); opacity: 0; } to { transform: scale(1); opacity: 1; } }

        /* Ruleta */
        .wheel-wrapper { padding: 30px 20px; text-align: center; }
        .wheel-btn { background: var(--fiore-burgundy); color: white; border: none; padding: 12px 40px; border-radius: 30px; font-size: 16px; margin-top: 20px; cursor: pointer; box-shadow: 0 5px 15px rgba(107,46,62,0.3); font-weight: 700; }
        .wheel-btn:disabled { background: #ccc; cursor: not-allowed; }
        .wheel-pointer { width: 30px; height: 30px; background: var(--fiore-burgundy); clip-path: polygon(100% 0, 0 0, 50% 100%); position: absolute; top: 10px; left: 50%; transform: translateX(-50%); z-index: 5; }
    </style>
</head>
<body>

    <div class="app-container">
        <header id="inicio">
            <div class="nav-top">
                <div style="text-align: center;">
                    <div class="header-title serif-font">Fiore Di Ale</div>
                    <div class="header-subtitle">Detalles que Enamoran</div>
                </div>
                <i class="fas fa-bars menu-toggle" onclick="toggleMenu()"></i>
            </div>
            <nav class="nav-menu" id="navMenu">
                <a href="#catalogo" class="nav-link" onclick="toggleMenu()">Cat√°logo</a>
                <a href="#testimonios" class="nav-link" onclick="toggleMenu()">Testimonios</a>
                <a href="#nosotros" class="nav-link" onclick="toggleMenu()">Sobre Nosotros</a>
                <a href="#contacto" class="nav-link" onclick="toggleMenu()">Cont√°ctanos</a>
            </nav>
        </header>

        <div class="featured-section">
            <h2 class="section-title serif-font">Novedades</h2>
            <div class="featured-grid" id="featuredGrid"></div>
        </div>

        <section id="catalogo" style="padding: 20px 0;">
            <h2 class="section-title serif-font" style="display:block; text-align:center;">Cat√°logo</h2>
            
            <div class="controls-container">
                <div class="search-box">
                    <i class="fas fa-search" style="color: #999;"></i>
                    <input type="text" id="searchInput" placeholder="Buscar..." onkeyup="renderProducts()">
                </div>
                <select class="sort-select" id="sortSelect" onchange="renderProducts()">
                    <option value="def">Orden</option>
                    <option value="low">Menor Precio</option>
                    <option value="high">Mayor Precio</option>
                </select>
            </div>

            <div class="filter-wrapper">
                <div class="filters" id="filtersContainer"></div>
            </div>

            <div class="product-grid" id="productGrid">
                <p style="text-align: center; width: 100%; grid-column: 1/-1;">Cargando cat√°logo...</p>
            </div>
        </section>

        <section id="testimonios" class="testi-section">
            <h2 class="section-title serif-font" style="display:block; text-align:center;">Testimonios</h2>
            <div class="testimonials-wrapper">
                <div class="testi-card active">
                    <img src="https://images.unsplash.com/photo-1544005313-94ddf0286df2?auto=format&fit=crop&w=400&q=80" class="testi-img">
                    <div class="testi-text">"El ramo lleg√≥ precioso y s√∫per puntual a Comas. La presentaci√≥n es A1."</div>
                    <div class="testi-author">Mariana G.</div>
                </div>
                <div class="testi-card">
                    <img src="https://images.unsplash.com/photo-1506794778202-cad84cf45f1d?auto=format&fit=crop&w=400&q=80" class="testi-img">
                    <div class="testi-text">"Ped√≠ un box para mi aniversario y mi novia qued√≥ encantada. Recomendado."</div>
                    <div class="testi-author">Carlos R.</div>
                </div>
                <div class="testi-card">
                    <img src="https://images.unsplash.com/photo-1438761681033-6461ffad8d80?auto=format&fit=crop&w=400&q=80" class="testi-img">
                    <div class="testi-text">"Los tulipanes duraron much√≠simo. Se nota la calidad y el cari√±o."</div>
                    <div class="testi-author">Fernanda L.</div>
                </div>
            </div>
        </section>

        <section id="nosotros" class="about-section">
            <div class="about-container">
                <img src="https://wsrv.nl/?url=https%3A%2F%2Fdrive.google.com%2Fuc%3Fexport%3Dview%26id%3D1y77i0p6w59SkNAB_RYxG3DLC67mH7Zy1" class="about-img">
                <div class="about-txt">
                    <h2 class="serif-font" style="color: var(--fiore-burgundy); font-size: 28px; margin-bottom: 20px;">Nuestra Pasi√≥n</h2>
                    <p>En Fiore Di Ale, creemos que cada detalle cuenta. Nos dedicamos a crear arreglos florales y regalos personalizados que transmiten emociones.</p>
                    <br>
                    <p>Desde nuestro taller en Lima, seleccionamos cuidadosamente cada flor para asegurar frescura y belleza. Nuestro objetivo es ser parte de tus momentos m√°s especiales.</p>
                </div>
            </div>
        </section>

        <footer id="contacto" class="footer-contact">
            <h3 class="serif-font" style="color: var(--fiore-burgundy); font-size: 24px;">Cont√°ctanos</h3>
            <div class="social-icons">
                <a href="https://www.instagram.com/alessiadesigns/" target="_blank" class="social-link"><i class="fab fa-instagram"></i></a>
                <a href="https://www.tiktok.com/@alessia.desing" target="_blank" class="social-link"><i class="fab fa-tiktok"></i></a>
                <a href="https://wa.me/51977414678" target="_blank" class="social-link" style="color: #25D366;"><i class="fab fa-whatsapp"></i></a>
            </div>
            <p style="font-size: 11px; color: #bbb; margin-top: 30px;">¬© 2026 Fiore Di Ale.</p>
        </footer>

        <div id="discountContainer" class="discount-container">
            <div style="display:flex; justify-content:space-between; font-size:11px; color:var(--fiore-burgundy); font-weight:700;">
                <span id="discountStatus">Meta: S/100</span>
                <span id="progressPercent">0%</span>
            </div>
            <div class="progress-track"><div id="progressBar" class="progress-fill"></div></div>
            <div id="nextRewardText" style="text-align:center; font-size:10px; color:#888; margin-top:5px;"></div>
        </div>

        <div id="whatsappFloat" class="whatsapp-float" onclick="sendOrder()">
            <span id="floatText">Ver Pedido (0)</span>
            <span id="floatTotal">S/0.00</span>
        </div>

        <div id="wheelModal" class="modal-overlay">
            <div class="modal-box">
                <div style="position:absolute; top:10px; right:15px; font-size:20px; cursor:pointer;" onclick="closeModal('wheelModal')">√ó</div>
                <div class="wheel-wrapper">
                    <h3 class="serif-font" style="color:var(--fiore-burgundy);">¬°Gira y Gana!</h3>
                    <div style="position:relative; width:250px; height:250px; margin:20px auto;">
                        <div class="wheel-pointer"></div>
                        <canvas id="wheelCanvas" width="250" height="250"></canvas>
                    </div>
                    <button id="spinBtn" class="wheel-btn" onclick="spin()">GIRAR</button>
                    <div id="wheelResult" style="margin-top:15px; font-weight:700; color:var(--gold); height:20px;"></div>
                </div>
            </div>
        </div>

        <div id="productModal" class="modal-overlay" onclick="if(event.target === this) closeModal('productModal')">
            <div class="modal-box">
                <div style="position:absolute; top:10px; right:15px; font-size:20px; cursor:pointer; z-index:10;" onclick="closeModal('productModal')">√ó</div>
                <img id="mImg" src="" style="width:100%; height:300px; object-fit:cover;">
                <div style="padding:20px;">
                    <h3 id="mTitle" class="serif-font" style="color:var(--fiore-burgundy);"></h3>
                    <div id="mPrice" style="font-size:22px; font-weight:700; margin:10px 0; color:#333;"></div>
                    <p id="mDesc" style="font-size:13px; color:#666;"></p>
                    <button class="wheel-btn" style="width:100%; margin-top:20px;" onclick="closeModal('productModal')">Cerrar</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const SHEET_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSqdgnG5y9lb3VHDfR7GHDBEW7XQKypCGiAo_-ORNZDwL8p9iiyxi4JWOeij5TauFPdplA083H7D3kX/pub?output=csv';
        const WHATSAPP_NUM = '51977414678';

        let products = [], cart = [], currentCategory = 'Todos';
        const PRIZES = ['Chocolate', 'Env√≠o Gratis', 'Tarjeta', 'Girasol', 'Bombones', 'Dedicatoria'];
        const COLORS = ['#EFA2A5', '#FCE4EC', '#EFA2A5', '#FCE4EC', '#EFA2A5', '#FCE4EC'];

        async function init() {
    try {
        const res = await fetch(SHEET_URL);
        const text = await res.text();
        products = parseCSV(text);
        
        renderFeatured();
        renderCategories();
        renderProducts();
        
        // --- AGREGA ESTA L√çNEA AQU√ç: ---
        initTestimonials(); 
        // -------------------------------

        if(!localStorage.getItem('fiore_played_final_v2')) {
            setTimeout(() => {
                document.getElementById('wheelModal').style.display = 'flex';
                drawWheel();
            }, 2000);
        }
    } catch (error) {
        console.error("Error cargando Sheet:", error);
    }
}

        /* --- PARSEO INTELIGENTE DE COLUMNAS --- */
        function parseCSV(csv) {
            const rows = csv.split('\n');
            if (rows.length < 2) return [];

            // 1. Detectar √≠ndices de columnas basados en la primera fila (headers)
            const headers = rows[0].toLowerCase().split(',').map(h => h.trim().replace(/"/g, ''));
            
            // Buscar en qu√© posici√≥n est√° cada dato (ej: "price" est√° en columna 2 o 3?)
            const idxId = headers.findIndex(h => h.includes('id'));
            const idxName = headers.findIndex(h => h.includes('name') || h.includes('nombre'));
            const idxPrice = headers.findIndex(h => h.includes('price') || h.includes('precio'));
            const idxCat = headers.findIndex(h => h.includes('category') || h.includes('categoria'));
            const idxImg = headers.findIndex(h => h.includes('image') || h.includes('imagen'));
            const idxTag = headers.findIndex(h => h.includes('tag') || h.includes('etiqueta'));
            const idxDesc = headers.findIndex(h => h.includes('desc') || h.includes('descripcion'));

            const result = [];
            for (let i = 1; i < rows.length; i++) {
                if (!rows[i].trim()) continue;
                // Dividir respetando comas
                const d = rows[i].split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
                
                // Usar los √≠ndices detectados (si no encuentra, usa fallbacks 0,1,2...)
                const id = Number(d[idxId > -1 ? idxId : 0]?.replace(/"/g, ''));
                if (id) {
                    result.push({
                        id: id,
                        name: d[idxName > -1 ? idxName : 1]?.replace(/"/g, '').trim(),
                        price: Number(d[idxPrice > -1 ? idxPrice : 2]?.replace(/"/g, '')),
                        category: d[idxCat > -1 ? idxCat : 3]?.replace(/"/g, '').trim(),
                        image: d[idxImg > -1 ? idxImg : 4]?.replace(/"/g, '').trim(),
                        tag: d[idxTag > -1 ? idxTag : 5]?.replace(/"/g, '').trim(),
                        description: d[idxDesc > -1 ? idxDesc : 6]?.replace(/"/g, '').trim()
                    });
                }
            }
            return result;
        }

        // --- L√ìGICA TESTIMONIOS M√ìVIL (CARRUSEL) ---
        function initTestimonials() {
            // Solo activar si es pantalla m√≥vil
            if (window.innerWidth < 768) {
                const slides = document.querySelectorAll('.testi-card');
                let index = 0;
                setInterval(() => {
                    slides[index].classList.remove('active');
                    index = (index + 1) % slides.length;
                    slides[index].classList.add('active');
                }, 5000); // 5 segundos
            }
        }

        function renderFeatured() {
            const feats = products.slice(-3).reverse();
            document.getElementById('featuredGrid').innerHTML = feats.map(p => `
                <div class="featured-card" onclick="openModal(${p.id})">
                    <div class="featured-badge">NUEVO</div>
                    <img src="${fixUrl(p.image)}" class="featured-img">
                    <div class="featured-info">
                        <div style="font-weight:600; font-size:13px;">${p.name}</div>
                        <div style="color:var(--fiore-burgundy); font-weight:700;">S/${p.price}</div>
                    </div>
                </div>
            `).join('');
        }

        function renderCategories() {
            const cats = ['Todos', ...new Set(products.map(p => p.category).filter(Boolean))];
            document.getElementById('filtersContainer').innerHTML = cats.map(c => 
                `<button class="filter-btn ${c==='Todos'?'active':''}" onclick="filter('${c}', this)">${c}</button>`
            ).join('');
        }

        function filter(c, btn) {
            currentCategory = c;
            document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            renderProducts();
        }

        function renderProducts() {
            const term = document.getElementById('searchInput').value.toLowerCase();
            const sort = document.getElementById('sortSelect').value;
            
            let list = products.filter(p => 
                (currentCategory === 'Todos' || p.category === currentCategory) &&
                p.name.toLowerCase().includes(term)
            );

            if(sort === 'low') list.sort((a,b) => a.price - b.price);
            if(sort === 'high') list.sort((a,b) => b.price - a.price);

            const grid = document.getElementById('productGrid');
            if(list.length === 0) {
                grid.innerHTML = '<p style="grid-column:1/-1; text-align:center;">No se encontraron productos.</p>';
                return;
            }

            grid.innerHTML = list.map(p => {
                const inCart = cart.some(i => i.id === p.id && !i.isFree);
                return `
                <div class="card ${inCart ? 'selected' : ''}">
                    <div class="card-image-container" onclick="openModal(${p.id})">
                        ${p.tag ? `<span class="badge-offer">${p.tag}</span>` : ''}
                        <img src="${fixUrl(p.image)}" class="card-img">
                    </div>
                    <div class="card-content">
                        <div>
                            <div class="card-title">${p.name}</div>
                            <div class="price">S/${p.price}</div>
                        </div>
                        <button class="btn-select ${inCart?'active':''}" onclick="toggle(${p.id})">
                            ${inCart ? 'Quitar' : 'Agregar'}
                        </button>
                    </div>
                </div>`;
            }).join('');
        }

        function toggle(id) {
            const idx = cart.findIndex(i => i.id === id && !i.isFree);
            if(idx > -1) cart.splice(idx, 1);
            else cart.push({ id, isFree: false });
            updateUI();
            renderProducts();
        }

        function updateUI() {
            let total = 0, count = 0;
            cart.forEach(i => {
                if(!i.isFree) {
                    const p = products.find(x => x.id === i.id);
                    if(p) total += p.price;
                }
                count++;
            });

            const float = document.getElementById('whatsappFloat');
            const discBar = document.getElementById('discountContainer');
            
            if(count > 0) {
                float.classList.add('visible');
                discBar.classList.add('visible');
                document.getElementById('floatText').innerText = `Ver Pedido (${count})`;
                document.getElementById('floatTotal').innerText = `S/${total.toFixed(2)}`;
            } else {
                float.classList.remove('visible');
                discBar.classList.remove('visible');
            }

            let target = 100, nextPct = 5;
            if(total >= 100) { target = 150; nextPct = 8; }
            if(total >= 150) { target = 200; nextPct = 10; }
            if(total >= 200) { target = total; nextPct = 0; }

            const fill = document.getElementById('progressBar');
            if(nextPct > 0) {
                const p = (total / target) * 100;
                fill.style.width = `${p}%`;
                document.getElementById('discountStatus').innerText = `S/${total} / S/${target}`;
                document.getElementById('progressPercent').innerText = `${Math.floor(p)}%`;
                document.getElementById('nextRewardText').innerText = `Faltan S/${(target-total).toFixed(2)} para ${nextPct}% OFF`;
            } else {
                fill.style.width = '100%';
                document.getElementById('discountStatus').innerText = "¬°Meta Cumplida!";
                document.getElementById('progressPercent').innerText = "100%";
                document.getElementById('nextRewardText').innerText = "üéâ Tienes 10% de descuento";
            }
        }

        const cvs = document.getElementById('wheelCanvas');
        const ctx = cvs.getContext('2d');
        const arc = (2 * Math.PI) / PRIZES.length;

        function drawWheel(rot = 0) {
            ctx.clearRect(0,0,250,250);
            PRIZES.forEach((p, i) => {
                const ang = i * arc + rot;
                ctx.beginPath(); ctx.fillStyle = COLORS[i];
                ctx.moveTo(125,125); ctx.arc(125,125,125, ang, ang + arc);
                ctx.fill(); ctx.stroke();
                
                ctx.save();
                ctx.translate(125 + Math.cos(ang + arc/2)*80, 125 + Math.sin(ang + arc/2)*80);
                ctx.rotate(ang + arc/2 + Math.PI/2);
                ctx.fillStyle = "#6B2E3E"; ctx.font = "bold 12px Poppins";
                ctx.fillText(p, -ctx.measureText(p).width/2, 0);
                ctx.restore();
            });
        }

        function spin() {
            document.getElementById('spinBtn').disabled = true;
            const winIndex = Math.floor(Math.random() * PRIZES.length);
            const prize = PRIZES[winIndex];
            
            const rotations = 5 * (2*Math.PI);
            const prizeCenter = (winIndex * arc) + (arc/2);
            const finalAngle = rotations + (1.5 * Math.PI - prizeCenter);

            let start = null;
            function animate(ts) {
                if(!start) start = ts;
                const p = ts - start;
                if(p < 4000) {
                    const ease = 1 - Math.pow(1 - p/4000, 3);
                    drawWheel(finalAngle * ease);
                    requestAnimationFrame(animate);
                } else {
                    drawWheel(finalAngle);
                    document.getElementById('wheelResult').innerText = `¬°Ganaste: ${prize}!`;
                    cart.push({ id: 9999, isFree: true, name: prize });
                    updateUI();
                    localStorage.setItem('fiore_played_final_v2', 'true');
                    setTimeout(() => closeModal('wheelModal'), 3000);
                }
            }
            requestAnimationFrame(animate);
        }

        function fixUrl(u) {
            if(!u) return 'https://via.placeholder.com/300';
            if(u.includes('drive.google.com')) {
                const id = u.split('/d/')[1]?.split('/')[0];
                return `https://wsrv.nl/?url=${encodeURIComponent('https://drive.google.com/uc?export=view&id=' + id)}`;
            }
            return `https://wsrv.nl/?url=${encodeURIComponent(u)}`;
        }
        
        function toggleMenu() { document.getElementById('navMenu').classList.toggle('active'); }
        
        function openModal(id) {
            const p = products.find(x => x.id === id);
            document.getElementById('mImg').src = fixUrl(p.image);
            document.getElementById('mTitle').innerText = p.name;
            document.getElementById('mPrice').innerText = `S/${p.price}`;
            document.getElementById('mDesc').innerText = p.description || '';
            document.getElementById('productModal').style.display = 'flex';
        }
        function closeModal(id) { document.getElementById(id).style.display = 'none'; }
        // --- FUNCI√ìN PARA MOVER LOS TESTIMONIOS ---
function initTestimonials() {
    // Solo activar el carrusel si la pantalla es peque√±a (M√≥vil)
    if (window.innerWidth < 768) {
        const slides = document.querySelectorAll('.testi-card');
        
        // Si no hay testimonios, no hacemos nada
        if (slides.length === 0) return;

        let index = 0;
        
        // Iniciamos el ciclo de 5 segundos
        setInterval(() => {
            // 1. Ocultamos el actual
            slides[index].classList.remove('active');
            
            // 2. Calculamos el siguiente (si llega al final, vuelve al 0)
            index = (index + 1) % slides.length;
            
            // 3. Mostramos el nuevo
            slides[index].classList.add('active');
        }, 5000); // 5000 milisegundos = 5 segundos
    }
}



        function sendOrder() {
            let msg = "Hola Fiore Di Ale, deseo pedir:%0A";
            let sub = 0;
            cart.forEach(i => {
                if(i.isFree) msg += `üéÅ REGALO: ${i.name}%0A`;
                else {
                    const p = products.find(x=>x.id===i.id);
                    if(p) { msg += `‚ñ™Ô∏è ${p.name} (S/${p.price})%0A`; sub += p.price; }
                }
            });
            let d = 0;
            if(sub >= 200) d = 0.1; else if(sub >= 150) d = 0.08; else if(sub >= 100) d = 0.05;
            msg += `%0A*Subtotal: S/${sub.toFixed(2)}*`;
            if(d>0) msg += `%0A*Descuento: -S/${(sub*d).toFixed(2)}*`;
            msg += `%0A*TOTAL: S/${(sub*(1-d)).toFixed(2)}*`;
            window.open(`https://wa.me/${WHATSAPP_NUM}?text=${msg}`);
        }

        init();
    </script>
</body>
</html>
